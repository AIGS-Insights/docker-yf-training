# Template for Azure Container App
# Tokens replaced by deploy script:
#   __CONTAINER_NAME__ __LOCATION__ __ENVIRONMENT_ID__ __CONTAINER_IMAGE__ __STORAGE_LINK__ __CONTAINER_CPU__ __CONTAINER_MEMORY__

name: __CONTAINER_NAME__
type: Microsoft.App/containerApps
location: __LOCATION__
properties:
  environmentId: __ENVIRONMENT_ID__
  configuration:
    activeRevisionsMode: Single
    ingress:
      external: true
      allowInsecure: false
      targetPort: 8080
      transport: auto
    secrets:
    -   name: repo-password
        value: __REPO_PASSWORD__
    registries:
      - server: __CONTAINER_REPO__
        username: __REPO_USERNAME__
        passwordSecretRef: repo-password
  template:
    containers:
      - name: __CONTAINER_NAME__
        image: __CONTAINER_IMAGE__
        resources:
          cpu: __CONTAINER_CPU__
          memory: __CONTAINER_MEMORY__
        volumeMounts:
          - volumeName: yellowfin-config
            mountPath: /opt/yellowfin/data
    scale:
      minReplicas: 1
      maxReplicas: 1
    volumes:
      - name: yellowfin-config
        storageType: AzureFile
        storageName: __STORAGE_LINK__
